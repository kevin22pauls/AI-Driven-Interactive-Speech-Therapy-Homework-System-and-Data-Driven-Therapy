<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recording Analysis</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background: #f5f7fa;
      color: #333;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      font-size: 13px;
    }

    /* Header - Compact */
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 8px 16px;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .header h1 { font-size: 14px; font-weight: 600; }
    .header .meta { font-size: 11px; opacity: 0.9; }
    .header .back-btn {
      padding: 6px 12px;
      background: rgba(255,255,255,0.2);
      color: white;
      text-decoration: none;
      border-radius: 4px;
      font-size: 12px;
    }

    /* Tabs - Compact */
    .tabs {
      display: flex;
      background: #fff;
      border-bottom: 1px solid #e2e8f0;
      padding: 0 12px;
    }
    .tab-btn {
      padding: 10px 16px;
      border: none;
      background: none;
      font-size: 12px;
      font-weight: 500;
      color: #64748b;
      cursor: pointer;
      border-bottom: 2px solid transparent;
    }
    .tab-btn:hover { color: #667eea; }
    .tab-btn.active { color: #667eea; border-bottom-color: #667eea; }

    /* Tab Content */
    .tab-content { flex: 1; overflow-y: auto; padding: 12px; }
    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    /* Cards - Compact */
    .card {
      background: #fff;
      border-radius: 6px;
      padding: 12px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      border: 1px solid #e2e8f0;
      margin-bottom: 10px;
    }
    .card h3 {
      font-size: 11px;
      font-weight: 600;
      color: #64748b;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Summary Row - Compact */
    .summary-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-bottom: 12px;
    }
    @media (max-width: 800px) { .summary-row { grid-template-columns: repeat(2, 1fr); } }
    .summary-card {
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      padding: 12px;
      text-align: center;
    }
    .summary-card.highlight { background: #f8f7ff; border-color: #667eea40; }
    .summary-card .big-value { font-size: 24px; font-weight: 700; color: #1e293b; }
    .summary-card .big-value.good { color: #059669; }
    .summary-card .big-value.warn { color: #d97706; }
    .summary-card .big-value.bad { color: #dc2626; }
    .summary-card .label { font-size: 10px; color: #64748b; margin-top: 4px; text-transform: uppercase; }
    .summary-card .sub { font-size: 9px; color: #94a3b8; margin-top: 2px; }

    /* Progress Bar - Thin */
    .prog { height: 4px; background: #e2e8f0; border-radius: 2px; margin-top: 8px; overflow: hidden; }
    .prog .fill { height: 100%; border-radius: 2px; }
    .prog .fill.good { background: #10b981; }
    .prog .fill.warn { background: #f59e0b; }
    .prog .fill.bad { background: #ef4444; }

    /* Tables - Compact */
    .tbl { width: 100%; border-collapse: collapse; font-size: 12px; }
    .tbl th {
      background: #f8fafc;
      padding: 6px 8px;
      text-align: left;
      font-weight: 600;
      color: #64748b;
      border-bottom: 1px solid #e2e8f0;
      font-size: 10px;
      text-transform: uppercase;
    }
    .tbl td { padding: 6px 8px; border-bottom: 1px solid #f1f5f9; }
    .tbl tr:last-child td { border-bottom: none; }
    .tbl .mono { font-family: monospace; font-size: 11px; }

    /* Badges */
    .badge {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 10px;
      font-weight: 500;
    }
    .badge.good { background: #d1fae5; color: #065f46; }
    .badge.warn { background: #fef3c7; color: #92400e; }
    .badge.bad { background: #fee2e2; color: #991b1b; }
    .badge.info { background: #e0e7ff; color: #3730a3; }
    .badge.sub { background: #fef3c7; color: #92400e; }
    .badge.del { background: #fee2e2; color: #991b1b; }
    .badge.ins { background: #dbeafe; color: #1e40af; }

    /* Grid layouts */
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
    @media (max-width: 700px) { .grid-2, .grid-3 { grid-template-columns: 1fr; } }

    /* Transcript - Compact */
    .transcript { background: #f8fafc; padding: 10px; border-radius: 4px; margin-bottom: 8px; border-left: 3px solid #667eea; }
    .transcript.exp { border-left-color: #94a3b8; }
    .transcript.act { border-left-color: #10b981; }
    .transcript .lbl { font-size: 9px; text-transform: uppercase; color: #64748b; margin-bottom: 4px; font-weight: 600; }
    .transcript .txt { font-size: 13px; line-height: 1.4; }

    /* Chips - Compact */
    .chips { display: flex; flex-wrap: wrap; gap: 4px; }
    .chip {
      padding: 3px 8px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 11px;
    }

    /* Bool indicators */
    .bool { display: inline-flex; align-items: center; gap: 4px; margin-right: 12px; font-size: 11px; }
    .bool .dot { width: 8px; height: 8px; border-radius: 50%; }
    .bool .dot.yes { background: #10b981; }
    .bool .dot.no { background: #d1d5db; }

    /* Severity */
    .sev { display: inline-block; padding: 4px 10px; border-radius: 4px; font-weight: 600; font-size: 11px; }
    .sev.normal { background: #d1fae5; color: #065f46; }
    .sev.mild { background: #fef3c7; color: #92400e; }
    .sev.moderate { background: #fed7aa; color: #9a3412; }
    .sev.severe { background: #fee2e2; color: #991b1b; }

    /* Notes */
    .note { padding: 8px 10px; background: #fffbeb; border-left: 2px solid #f59e0b; margin-bottom: 6px; font-size: 11px; color: #92400e; border-radius: 0 4px 4px 0; }

    /* Loading */
    .loading { text-align: center; padding: 40px; color: #64748b; }
    .error { background: #fee2e2; color: #991b1b; padding: 16px; border-radius: 6px; text-align: center; margin: 16px; }
  </style>
</head>
<body>
  <div id="app"><div class="loading">Loading...</div></div>

  <script>
    const API = "http://127.0.0.1:8001";

    async function load() {
      const id = new URLSearchParams(location.search).get('recording_id');
      if (!id) return document.getElementById('app').innerHTML = '<div class="error">No recording ID</div>';
      try {
        const r = await fetch(`${API}/recording/${id}`);
        if (!r.ok) throw new Error('Not found');
        render(await r.json());
      } catch (e) {
        document.getElementById('app').innerHTML = `<div class="error">${e.message}</div>`;
      }
    }

    const scoreClass = (v, t=[0.8,0.5]) => v >= t[0] ? 'good' : v >= t[1] ? 'warn' : 'bad';
    const errClass = (v, t=[0.1,0.3]) => v <= t[0] ? 'good' : v <= t[1] ? 'warn' : 'bad';
    const pct = v => v != null ? (v * 100).toFixed(0) + '%' : 'N/A';
    const num = (v, d=1) => v != null ? v.toFixed(d) : 'N/A';

    function render(r) {
      const pid = r.patient_id || r.session_id?.split('_')[0] || 'N/A';
      document.getElementById('app').innerHTML = `
        <div class="header">
          <div><h1>#${r.id}: ${r.object_name || 'Unknown'}</h1><span class="meta">Patient: ${pid} | ${new Date(r.created_at).toLocaleString()}</span></div>
          <a href="/dashboard" class="back-btn">← Back</a>
        </div>
        <div class="tabs">
          <button class="tab-btn active" data-tab="overview">Overview</button>
          <button class="tab-btn" data-tab="phoneme">Phoneme</button>
          <button class="tab-btn" data-tab="fluency">Fluency</button>
          <button class="tab-btn" data-tab="ml">ML</button>
          <button class="tab-btn" data-tab="raw">JSON</button>
        </div>
        <div class="tab-content">
          ${overviewTab(r)}
          ${phonemeTab(r)}
          ${fluencyTab(r)}
          ${mlTab(r)}
          ${rawTab(r)}
        </div>
      `;
      document.querySelectorAll('.tab-btn').forEach(b => b.onclick = () => {
        document.querySelectorAll('.tab-btn').forEach(x => x.classList.remove('active'));
        document.querySelectorAll('.tab-panel').forEach(x => x.classList.remove('active'));
        b.classList.add('active');
        document.getElementById('tab-' + b.dataset.tab).classList.add('active');
      });
    }

    function overviewTab(r) {
      const sem = r.semantic_score || 0;
      const per = r.per || 0;
      const flu = r.fluency_percentage || r.standard_fluency_pct || 0;
      return `
        <div class="tab-panel active" id="tab-overview">
          <div class="summary-row">
            <div class="summary-card highlight">
              <div class="big-value ${scoreClass(sem)}">${pct(sem)}</div>
              <div class="label">Semantic</div>
              <div class="prog"><div class="fill ${scoreClass(sem)}" style="width:${sem*100}%"></div></div>
            </div>
            <div class="summary-card">
              <div class="big-value ${errClass(per)}">${pct(per)}</div>
              <div class="label">PER</div>
              <div class="prog"><div class="fill ${errClass(per)}" style="width:${Math.min(per*100,100)}%"></div></div>
            </div>
            <div class="summary-card">
              <div class="big-value ${scoreClass(flu/100)}">${flu.toFixed(0)}%</div>
              <div class="label">Fluency</div>
              <div class="prog"><div class="fill ${scoreClass(flu/100)}" style="width:${flu}%"></div></div>
            </div>
            <div class="summary-card">
              <div class="big-value">${num(r.speech_rate,0)}</div>
              <div class="label">WPM</div>
            </div>
          </div>

          <div class="grid-2">
            <div class="card">
              <h3>Transcript</h3>
              <div class="transcript exp"><div class="lbl">Expected</div><div class="txt">${r.prompt_text || r.expected_answer || 'N/A'}</div></div>
              <div class="transcript act"><div class="lbl">Actual</div><div class="txt">${r.transcript || '(none)'}</div></div>
            </div>
            <div class="card">
              <h3>Semantic Analysis</h3>
              <div style="margin-bottom:8px"><span class="sev ${(r.semantic_classification||'').toLowerCase()==='correct'?'normal':(r.semantic_classification||'').toLowerCase()==='partial'?'mild':'severe'}">${r.semantic_classification || 'N/A'}</span></div>
              <table class="tbl">
                <tr><td>Overall</td><td><strong>${pct(r.semantic_score)}</strong></td></tr>
                <tr><td>Direct</td><td>${pct(r.direct_similarity)}</td></tr>
                <tr><td>Category</td><td>${pct(r.category_similarity)}</td></tr>
                <tr><td>WER</td><td>${pct(r.wer)}</td></tr>
              </table>
              <div style="margin-top:8px">
                <span class="bool"><span class="dot ${r.circumlocution_detected?'yes':'no'}"></span>Circumlocution</span>
                <span class="bool"><span class="dot ${r.conduite_d_approche_detected?'yes':'no'}"></span>Self-correct</span>
                <span class="bool"><span class="dot ${r.semantic_paraphasia?.detected?'yes':'no'}"></span>Paraphasia</span>
              </div>
            </div>
          </div>

          <div class="card">
            <h3>Quick Stats</h3>
            <div class="grid-3">
              <table class="tbl">
                <tr><td>Total Phonemes</td><td><strong>${r.total_phonemes||0}</strong></td></tr>
                <tr><td>Phoneme Errors</td><td>${r.phoneme_errors?.length||0}</td></tr>
              </table>
              <table class="tbl">
                <tr><td>Longest Fluent Run</td><td><strong>${r.longest_fluent_run||0}</strong></td></tr>
                <tr><td>Total Pauses</td><td>${r.pauses?.length||0}</td></tr>
              </table>
              <table class="tbl">
                <tr><td>Articulation Rate</td><td><strong>${num(r.articulation_rate)}</strong></td></tr>
                <tr><td>SSI-4 Severity</td><td>${r.ssi_severity||'N/A'}</td></tr>
              </table>
            </div>
          </div>
        </div>
      `;
    }

    function phonemeTab(r) {
      let rows = '';
      if (r.phoneme_errors?.length) {
        r.phoneme_errors.forEach((e,i) => {
          const tc = e.type?.includes('deletion')?'del':e.type?.includes('insertion')?'ins':'sub';
          const t = (e.type||'').replace('phonetically_similar_','~').replace('phonetically_dissimilar_','≠');
          rows += `<tr><td>${i+1}</td><td><strong>${e.word||'-'}</strong></td><td class="mono">/${e.expected||'-'}/</td><td class="mono">/${e.actual||'-'}/</td><td><span class="badge ${tc}">${t}</span></td><td style="font-size:10px;color:#64748b">${e.clinical_significance||''}</td></tr>`;
        });
      } else {
        rows = '<tr><td colspan="6" style="text-align:center;color:#94a3b8;padding:16px">No errors</td></tr>';
      }

      let prob = '', cls = '';
      if (r.problematic_phonemes) Object.entries(r.problematic_phonemes).forEach(([p,c]) => prob += `<span class="chip" style="background:#fee2e2;color:#991b1b">/${p}/ ×${c}</span>`);
      if (r.phoneme_class_errors) Object.entries(r.phoneme_class_errors).forEach(([k,v]) => cls += `<span class="chip" style="background:#e0e7ff;color:#3730a3">${k}:${v}</span>`);

      return `
        <div class="tab-panel" id="tab-phoneme">
          <div class="summary-row">
            <div class="summary-card"><div class="big-value ${errClass(r.per||0)}">${pct(r.per)}</div><div class="label">PER</div></div>
            <div class="summary-card"><div class="big-value ${errClass(r.wper||0)}">${pct(r.wper)}</div><div class="label">WPER</div></div>
            <div class="summary-card"><div class="big-value">${r.total_phonemes||0}</div><div class="label">Phonemes</div></div>
            <div class="summary-card"><div class="big-value ${r.phoneme_errors?.length>3?'bad':r.phoneme_errors?.length>0?'warn':'good'}">${r.phoneme_errors?.length||0}</div><div class="label">Errors</div></div>
          </div>

          ${prob||cls?`<div class="card"><h3>Problem Areas</h3>${prob?`<div style="margin-bottom:6px"><strong style="font-size:10px">Phonemes:</strong> <span class="chips">${prob}</span></div>`:''}${cls?`<div><strong style="font-size:10px">Classes:</strong> <span class="chips">${cls}</span></div>`:''}</div>`:''}

          <div class="card">
            <h3>Error Details</h3>
            <table class="tbl"><thead><tr><th>#</th><th>Word</th><th>Exp</th><th>Act</th><th>Type</th><th>Note</th></tr></thead><tbody>${rows}</tbody></table>
          </div>

          ${r.error_pattern_analysis&&Object.keys(r.error_pattern_analysis).length?`
          <div class="card">
            <h3>Error Patterns</h3>
            <table class="tbl">
              ${r.error_pattern_analysis.dominant_error_type?`<tr><td>Dominant Type</td><td><strong>${r.error_pattern_analysis.dominant_error_type}</strong></td></tr>`:''}
              ${r.error_pattern_analysis.most_affected_position?`<tr><td>Position</td><td>${r.error_pattern_analysis.most_affected_position}</td></tr>`:''}
              ${r.error_pattern_analysis.substitution_pattern?`<tr><td>Pattern</td><td>${r.error_pattern_analysis.substitution_pattern}</td></tr>`:''}
              ${r.error_pattern_analysis.consistency?`<tr><td>Consistency</td><td>${r.error_pattern_analysis.consistency}</td></tr>`:''}
            </table>
          </div>
          `:''}
        </div>
      `;
    }

    function fluencyTab(r) {
      const flu = r.fluency_percentage || r.standard_fluency_pct || 0;
      let pauses = '';
      if (r.pauses?.length) {
        r.pauses.slice(0,10).forEach((p,i) => {
          const tc = p.type==='anomic'?'warn':p.type==='block'?'bad':'info';
          pauses += `<tr><td>${i+1}</td><td><span class="badge ${tc}">${p.type||'pause'}</span></td><td>${num(p.duration,2)}s</td></tr>`;
        });
        if (r.pauses.length > 10) pauses += `<tr><td colspan="3" style="text-align:center;color:#94a3b8">+${r.pauses.length-10} more</td></tr>`;
      }

      return `
        <div class="tab-panel" id="tab-fluency">
          <div class="summary-row">
            <div class="summary-card highlight"><div class="big-value ${scoreClass(flu/100)}">${flu.toFixed(0)}%</div><div class="label">Fluency</div><div class="prog"><div class="fill ${scoreClass(flu/100)}" style="width:${flu}%"></div></div></div>
            <div class="summary-card"><div class="big-value">${r.longest_fluent_run||0}</div><div class="label">LFR</div><div class="sub">words</div></div>
            <div class="summary-card"><div class="big-value">${num(r.articulation_rate)}</div><div class="label">Art. Rate</div><div class="sub">syl/min</div></div>
            ${r.ssi_severity?`<div class="summary-card"><span class="sev ${r.ssi_severity}">${r.ssi_severity.toUpperCase()}</span><div class="label" style="margin-top:4px">SSI-4</div><div class="sub">Score: ${r.ssi_total_score||'?'}</div></div>`:''}
          </div>

          <div class="grid-2">
            <div class="card">
              <h3>Dysfluency Counts</h3>
              <table class="tbl">
                <tr><td>Pauses</td><td><strong>${r.pauses?.length||0}</strong></td><td>Anomic</td><td>${r.anomic_pause_count||0}</td></tr>
                <tr><td>Hesitations</td><td>${r.hesitation_count||0}</td><td>Apraxic</td><td>${r.apraxic_pause_count||0}</td></tr>
                <tr><td>Blocks</td><td>${r.block_count||0}</td><td>Per 100w</td><td>${num(r.dysfluencies_per_100_words)}</td></tr>
              </table>
            </div>
            <div class="card">
              <h3>Timing</h3>
              <table class="tbl">
                <tr><td>Speaking Rate</td><td>${num(r.speaking_rate)} syl/m</td></tr>
                <tr><td>Phonation Time</td><td>${num(r.phonation_time,2)}s</td></tr>
                <tr><td>Phonation Ratio</td><td>${pct(r.phonation_ratio)}</td></tr>
                <tr><td>Mean Pause</td><td>${num(r.mean_pause_duration,2)}s</td></tr>
              </table>
            </div>
          </div>

          <div class="grid-2">
            <div class="card">
              <h3>Rate Variability ${r.rate_trend?`<span class="badge ${r.rate_trend==='stable'?'good':'warn'}">${r.rate_trend}</span>`:''}</h3>
              <table class="tbl">
                <tr><td>Local CV</td><td>${num(r.local_cv,3)}</td><td>Global CV</td><td>${num(r.global_cv,3)}</td></tr>
                <tr><td>PVI</td><td>${num(r.normalized_pvi,3)}</td><td>Variability</td><td>${num(r.speech_rate_variability,3)}</td></tr>
              </table>
            </div>
            <div class="card">
              <h3>Fluency Scores</h3>
              <table class="tbl">
                <tr><td>Standard</td><td><strong>${num(r.standard_fluency_pct,0)}%</strong></td><td>Weighted</td><td>${num(r.weighted_fluency_pct,0)}%</td></tr>
                <tr><td>Clinical</td><td>${num(r.clinical_fluency_pct,0)}%</td><td>LFR Ratio</td><td>${pct(r.lfr_ratio)}</td></tr>
              </table>
            </div>
          </div>

          ${r.ssi_severity?`
          <div class="card">
            <h3>SSI-4 Breakdown</h3>
            <table class="tbl">
              <tr><th>Component</th><th>Value</th><th>Score</th></tr>
              <tr><td>Frequency</td><td>${num(r.ssi_frequency_pct)}%</td><td>${r.ssi_frequency_score||'?'}/10</td></tr>
              <tr><td>Duration</td><td>${num(r.ssi_avg_duration,2)}s</td><td>${r.ssi_duration_score||'?'}/10</td></tr>
              <tr><td><strong>Total</strong></td><td></td><td><strong>${r.ssi_total_score||'?'}</strong></td></tr>
            </table>
          </div>
          `:''}

          ${pauses?`<div class="card"><h3>Pause Log</h3><table class="tbl"><thead><tr><th>#</th><th>Type</th><th>Dur</th></tr></thead><tbody>${pauses}</tbody></table></div>`:''}

          ${(r.clinical_notes?.length||r.fluency_notes?.length)?`<div class="card"><h3>Clinical Notes</h3>${[...(r.clinical_notes||[]),...(r.fluency_notes||[])].map(n=>`<div class="note">${n}</div>`).join('')}</div>`:''}
        </div>
      `;
    }

    function mlTab(r) {
      let align = '', det = '', ipa = '';
      if (r.ml_alignment?.length) {
        r.ml_alignment.slice(0,25).forEach(p => {
          const [e,d] = Array.isArray(p) ? p : [p.expected, p.detected];
          const m = e === d;
          align += `<span class="chip" style="background:${m?'#d1fae5':'#fee2e2'};color:${m?'#065f46':'#991b1b'}">${e||'?'}→${d||'?'}</span>`;
        });
        if (r.ml_alignment.length > 25) align += `<span style="color:#94a3b8;font-size:10px">+${r.ml_alignment.length-25}</span>`;
      }
      if (r.ml_detected_phonemes?.length) r.ml_detected_phonemes.forEach(p => det += `<span class="chip" style="background:#e0e7ff;color:#3730a3">${p}</span>`);
      if (r.ml_detected_ipa?.length) r.ml_detected_ipa.forEach(p => ipa += `<span class="chip" style="background:#fef3c7;color:#92400e">${p}</span>`);

      return `
        <div class="tab-panel" id="tab-ml">
          <div class="summary-row">
            <div class="summary-card"><div class="big-value ${errClass(r.ml_per||0)}">${pct(r.ml_per)}</div><div class="label">ML PER</div></div>
            <div class="summary-card"><div class="big-value">${num(r.ml_gop,2)}</div><div class="label">GOP</div></div>
            <div class="summary-card"><div class="big-value ${scoreClass(r.ml_confidence||0)}">${pct(r.ml_confidence)}</div><div class="label">Confidence</div></div>
            <div class="summary-card"><div class="big-value">${r.ml_detected_phonemes?.length||0}</div><div class="label">Detected</div></div>
          </div>

          ${det?`<div class="card"><h3>Detected (ARPAbet)</h3><div class="chips">${det}</div></div>`:''}
          ${ipa?`<div class="card"><h3>Detected (IPA)</h3><div class="chips">${ipa}</div></div>`:''}
          ${align?`<div class="card"><h3>Alignment (Exp→Det)</h3><div class="chips">${align}</div><div style="margin-top:8px"><span class="chip" style="background:#d1fae5;color:#065f46">Match</span> <span class="chip" style="background:#fee2e2;color:#991b1b">Mismatch</span></div></div>`:''}

          ${r.ml_phoneme_scores?.length?`
          <div class="card">
            <h3>Per-Phoneme Scores</h3>
            <div class="chips">${r.ml_phoneme_scores.slice(0,25).map(s=>{const p=s.probability||0;return`<span class="chip badge ${p>0.9?'good':p>0.7?'warn':'bad'}">${s.phoneme} ${(p*100).toFixed(0)}%</span>`;}).join('')}${r.ml_phoneme_scores.length>25?`<span style="color:#94a3b8;font-size:10px">+${r.ml_phoneme_scores.length-25}</span>`:''}</div>
          </div>
          `:''}
        </div>
      `;
    }

    function rawTab(r) {
      return `
        <div class="tab-panel" id="tab-raw">
          <div class="card">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
              <h3 style="margin:0">Raw JSON</h3>
              <button onclick="navigator.clipboard.writeText(document.getElementById('json').textContent).then(()=>{this.textContent='✓ Copied';setTimeout(()=>this.textContent='Copy',1500)})" style="padding:4px 10px;background:#667eea;color:white;border:none;border-radius:4px;cursor:pointer;font-size:11px">Copy</button>
            </div>
            <pre id="json" style="background:#1e293b;color:#e2e8f0;padding:12px;border-radius:4px;overflow:auto;max-height:400px;font-size:11px;line-height:1.5">${JSON.stringify(r,null,2).replace(/</g,'&lt;')}</pre>
          </div>
        </div>
      `;
    }

    load();
  </script>
</body>
</html>
